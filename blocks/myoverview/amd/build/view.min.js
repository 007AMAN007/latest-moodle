function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_myoverview/view",["exports","jquery","block_myoverview/repository","core/paged_content_factory","core/pubsub","core/custom_interaction_events","core/notification","core/templates","core_course/events","block_myoverview/selectors","core/paged_content_events","core/aria"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.reset=a.init=void 0;b=o(b);c=n(c);d=n(d);e=n(e);f=n(f);g=n(g);h=n(h);i=n(i);j=o(j);k=n(k);l=n(l);function m(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;m=function(){return a};return a}function n(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=m();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function o(a){return a&&a.__esModule?a:{default:a}}function p(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);if(b)d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable});c.push.apply(c,d)}return c}function q(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};if(b%2){p(Object(c),!0).forEach(function(b){r(a,b,c[b])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(a,Object.getOwnPropertyDescriptors(c))}else{p(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}}return a}function r(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function s(a){return w(a)||v(a)||u(a)||t()}function t(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(a,b){if(!a)return;if("string"==typeof a)return x(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return x(a,b)}function v(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function w(a){if(Array.isArray(a))return x(a)}function x(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}var y={COURSES_CARDS:"block_myoverview/view-cards",COURSES_LIST:"block_myoverview/view-list",COURSES_SUMMARY:"block_myoverview/view-summary",NOCOURSES:"core_course/no-courses"},z={GROUPING_ALLINCLUDINGHIDDEN:"allincludinghidden",GROUPING_ALL:"all",GROUPING_INPROGRESS:"inprogress",GROUPING_FUTURE:"future",GROUPING_PAST:"past",GROUPING_FAVOURITES:"favourites",GROUPING_HIDDEN:"hidden"},A=[12,24,48,96,0],B=[],C=0,D=0,E=0,F=null,G=function(a){var b=a.find(j.default.courseView.region);return{display:b.attr("data-display"),grouping:b.attr("data-grouping"),sort:b.attr("data-sort"),displaycategories:b.attr("data-displaycategories"),customfieldname:b.attr("data-customfieldname"),customfieldvalue:b.attr("data-customfieldvalue")}},H={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"block_myoverview_user_paging_preference"},I=function(a,b){return c.getEnrolledCoursesByTimeline({offset:C,limit:b,classification:a.grouping,sort:a.sort,customfieldname:a.customfieldname,customfieldvalue:a.customfieldvalue})},J=function(a,b){return a.find(j.default.FAVOURITE_ICON+"[data-course-id=\""+b+"\"]")},K=function(a,b){return a.find("[data-region=\"paged-content-page\"][data-page=\""+b+"\"]")},L=function(a){return a.attr("data-course-id")},M=function(a,b){var c=J(a,b),d=c.find(j.default.ICON_IS_FAVOURITE);d.addClass("hidden");l.hide(d);var e=c.find(j.default.ICON_NOT_FAVOURITE);e.removeClass("hidden");l.unhide(e)},N=function(a,b){var c=J(a,b),d=c.find(j.default.ICON_IS_FAVOURITE);d.removeClass("hidden");l.unhide(d);var e=c.find(j.default.ICON_NOT_FAVOURITE);e.addClass("hidden");l.hide(e)},O=function(a,b){return a.find("[data-action=\"add-favourite\"][data-course-id=\""+b+"\"]")},P=function(a,b){return a.find("[data-action=\"remove-favourite\"][data-course-id=\""+b+"\"]")},Q=function(a,b){var c=P(a,b),d=O(a,b);Y(b,!0).then(function(f){if(f){e.publish(i.favorited,b);c.removeClass("hidden");d.addClass("hidden");N(a,b)}else{g.alert("Starring course failed","Could not change favourite state")}}).catch(g.exception)},R=function(a,b){var c=P(a,b),d=O(a,b);Y(b,!1).then(function(f){if(f){e.publish(i.unfavorited,b);c.addClass("hidden");d.removeClass("hidden");M(a,b)}else{g.alert("Starring course failed","Could not change favourite state")}}).catch(g.exception)},S=function(a,b){return a.find("[data-action=\"hide-course\"][data-course-id=\""+b+"\"]")},T=function(a,b){return a.find("[data-action=\"show-course\"][data-course-id=\""+b+"\"]")},U=function(a,b){var c=S(a,b),d=T(a,b),e=G(a);W(b,!0);if(e.grouping!==z.GROUPING_ALLINCLUDINGHIDDEN){X(a,b)}c.addClass("hidden");d.removeClass("hidden")},V=function(a,b){var c=S(a,b),d=T(a,b),e=G(a);W(b,null);if(e.grouping!==z.GROUPING_ALLINCLUDINGHIDDEN){X(a,b)}c.removeClass("hidden");d.addClass("hidden")},W=function(a,b){if(!1===b){b=null}return c.updateUserPreferences({preferences:[{type:"block_myoverview_hidden_course_"+a,value:b}]})},X=function(a,c){var e=a.find("[data-region=\"paging-bar\"]"),f=parseInt(e.attr("data-active-page-number")),i=B[f],j=i.courses.reduce(function(a,b){if(c!==b.id){a.push(b)}return a},[]);if(B[f+1]!==void 0){var l=B[f+1].courses.slice(0,1);B.forEach(function(a,b){if(b>f){var c=[];if(B[b+1]!==void 0){c=B[b+1].courses.slice(0,1)}B[b].courses=[].concat(s(B[b].courses.slice(1)),s(c))}});j=[].concat(s(j),s(l))}if(D===f+1&&0===B[f+1].courses.length){var m=a.find("[data-region=\"paged-content-container\"]");d.resetLastPageNumber((0,b.default)(m).attr("id"),f)}B[f].courses=j;C--;var k=K(a,f);Z(a,B[f]).then(function(a,b){return h.replaceNodeContents(k,a,b)}).catch(g.exception);B.forEach(function(b,c){if(c>f){var d=K(a,c);d.remove()}})},Y=function(a,b){return c.setFavouriteCourses({courses:[{id:a,favourite:b}]}).then(function(c){if(0===c.warnings.length){B.forEach(function(c){c.courses.forEach(function(d,e){if(d.id===a){c.courses[e].isfavourite=b}})});return!0}else{return!1}}).catch(g.exception)},Z=function(a,b){var c=G(a),d="";if("card"===c.display){d=y.COURSES_CARDS}else if("list"===c.display){d=y.COURSES_LIST}else{d=y.COURSES_SUMMARY}b.courses=b.courses.map(function(a){a.showcoursecategory="on"===c.displaycategories;return a});if(b.courses.length){return h.render(d,{courses:b.courses})}else{var e=a.find(j.default.courseView.region).attr("data-nocoursesimg");return h.render(y.NOCOURSES,{nocoursesimg:e})}},$=function(a){return function(b){return a.find(j.default.courseView.region).attr("data-paging",b)}},_=function(a,b){var c=b+k.SET_ITEMS_PER_PAGE_LIMIT;e.subscribe(c,$(a))},aa=function(a){F="block_myoverview_"+a.attr("id")+"_"+Math.random();var b=parseInt(a.find(j.default.courseView.region).attr("data-paging"),10),c=A.map(function(a){var c=!1;if(a===b){c=!0}return{value:a,active:c}}),e=parseInt(a.find(j.default.courseView.region).attr("data-totalcoursecount"),10);c=c.filter(function(a){return a.value<e||0===a.value});var f=G(a),i=q({},{},{},H);i.eventNamespace=F;var k=d.createWithLimit(c,function(b,c){var d=[];b.forEach(function(b){var e=b.pageNumber,h=0<b.limit?b.limit:0;if(E!==h){B=[];C=0;D=0}if(D===e){c.allItemsLoaded(D);d.push(Z(a,B[e]));return}E=h;if(B[e+1]===void 0){if(B[e]===void 0){h*=2}}var i=I(f,h).then(function(d){var f=d.courses,g=0,h=[];if(B[e]!==void 0){h=B[e].courses;var j=h.length;if(j<b.limit){g=b.limit-j;h=[].concat(s(B[e].courses),s(f.slice(0,g)))}}else{g=b.limit||!1;h=0<b.limit?f.slice(0,b.limit):f}B[e]={courses:h};var i=!1!==g?f.slice(g,f.length):[];if(i.length){B[e+1]={courses:i}}if(B[e].courses.length<b.limit||!i.length){D=e;c.allItemsLoaded(e)}else if(B[e+1]!==void 0&&B[e+1].courses.length<b.limit){D=e+1}C=d.nextoffset;return Z(a,B[e])}).catch(g.exception);d.push(i)});return d},i);k.then(function(b,c){_(a,F);return h.replaceNodeContents(a.find(j.default.courseView.region),b,c)}).catch(g.exception)},ba=function(a){f.define(a,[f.events.activate]);a.on(f.events.activate,j.default.ACTION_ADD_FAVOURITE,function(c,d){var e=(0,b.default)(c.target).closest(j.default.ACTION_ADD_FAVOURITE),f=L(e);Q(a,f);d.originalEvent.preventDefault()});a.on(f.events.activate,j.default.ACTION_REMOVE_FAVOURITE,function(c,d){var e=(0,b.default)(c.target).closest(j.default.ACTION_REMOVE_FAVOURITE),f=L(e);R(a,f);d.originalEvent.preventDefault()});a.on(f.events.activate,j.default.FAVOURITE_ICON,function(a,b){b.originalEvent.preventDefault()});a.on(f.events.activate,j.default.ACTION_HIDE_COURSE,function(c,d){var e=(0,b.default)(c.target).closest(j.default.ACTION_HIDE_COURSE),f=L(e);U(a,f);d.originalEvent.preventDefault()});a.on(f.events.activate,j.default.ACTION_SHOW_COURSE,function(c,d){var e=(0,b.default)(c.target).closest(j.default.ACTION_SHOW_COURSE),f=L(e);V(a,f);d.originalEvent.preventDefault()})},ca=function(a){a=(0,b.default)(a);B=[];D=0;C=0;aa(a);if(!a.attr("data-init")){ba(a);a.attr("data-init",!0)}};a.init=ca;var da=function(a){if(0<B.length){B.forEach(function(b,c){var d=K(a,c);Z(a,b).then(function(a,b){return h.replaceNodeContents(d,a,b)}).catch(g.exception)})}else{ca(a)}};a.reset=da});
//# sourceMappingURL=view.min.js.map
